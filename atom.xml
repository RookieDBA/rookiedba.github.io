<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[RookieDBA]]></title>
  <link href="http://RookieDBA.github.io/atom.xml" rel="self"/>
  <link href="http://RookieDBA.github.io/"/>
  <updated>2014-08-22T00:07:32+08:00</updated>
  <id>http://RookieDBA.github.io/</id>
  <author>
    <name><![CDATA[RookieDBA]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Expdp/impdp]]></title>
    <link href="http://RookieDBA.github.io/blog/2014/08/21/expdp-slash-impdp/"/>
    <updated>2014-08-21T22:29:20+08:00</updated>
    <id>http://RookieDBA.github.io/blog/2014/08/21/expdp-slash-impdp</id>
    <content type="html"><![CDATA[<p>今天用expdp和impdp做数据迁移，针对整个schema的数据导入导出，也很有幸体验到了exp和expdp在速度上的差别，因为exp要过一层buffer，所以速度上慢特别多，一个67G数据的schema，用expdp大概花了半个小时，而exp半个小时大概生成3G左右的数据，速度上还是相差很大的。</p>

<h1>EXPDP</h1>

<p>用expdp之前要在oracle中创建一个directory。</p>

<figure class='code'><figcaption><span>directory</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">conn</span> <span class="o">/</span> <span class="k">as</span> <span class="n">sysdba</span>
</span><span class='line'><span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="n">directory</span> <span class="n">dir_name</span> <span class="k">as</span> <span class="err">‘</span><span class="o">/</span><span class="n">path</span><span class="err">’</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后到os中，用expdp命令导出数据</p>

<figure class='code'><figcaption><span>expdp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">expdp</span> <span class="k">system</span><span class="o">/</span><span class="n">password</span> <span class="n">schemas</span><span class="o">=</span><span class="k">schema_name</span> <span class="n">directory</span><span class="o">=</span><span class="n">dump</span> <span class="n">dumpfile</span><span class="o">=</span><span class="n">out_file_name</span><span class="p">.</span><span class="n">dmp</span> <span class="n">logfile</span><span class="o">=</span><span class="n">log_file_name</span><span class="p">.</span><span class="n">log</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>则会在dump目录下生成dmp文件和log文件，这里的directory就是之前在Oracle中创建的directory。</p>

<h1>IMPDP</h1>

<p>用impdp来导入数据和前面一样，dmp文件就是之前expdp出来的dmp文件。</p>

<figure class='code'><figcaption><span>impdp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">impdp</span> <span class="k">system</span><span class="o">/</span><span class="n">password</span> <span class="n">schemas</span><span class="o">=</span><span class="k">schema_name</span> <span class="n">directory</span><span class="o">=</span><span class="n">dump</span> <span class="n">dumpfile</span><span class="o">=</span><span class="n">imp_file</span><span class="p">.</span><span class="n">dmp</span> <span class="n">logfile</span><span class="o">=</span><span class="n">log_imp</span><span class="p">.</span><span class="n">log</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>impdp似乎可以直接和expdp连接使用，就可以边导出边导入了，有待研究。</p>

<h1>关于NETWORK_LINK参数</h1>

<p>如果有指定NETWORK_LINK参数，则可以远程传输至目标端，network_link的值为dblink的名字。<br/>
首先，在目标端库建立一个dblink至源端。<br/>
expdp指定network_link参数将可以直接在目标端生成dump文件。<br/>
impdp指定network_link参数，可以直接绕过生成dump文件，直接从源端导出并导入目标端。<br/>
相应的EXP和IMP就简单一点（buffer设大一点快，exp不小于64000，imp不小于100000）</p>

<figure class='code'><figcaption><span>exp/imp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">exp</span> <span class="k">schema_name</span><span class="o">/</span><span class="n">password</span>  <span class="n">BUFFER</span><span class="o">=</span><span class="mi">1000000000</span> <span class="n">FILE</span><span class="o">=/</span><span class="k">data</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">dump</span><span class="o">/</span><span class="n">out_file_name</span><span class="p">.</span><span class="n">dmp</span> <span class="k">OWNER</span><span class="o">=</span><span class="k">schema_name</span> <span class="n">log</span><span class="o">=</span><span class="n">logfile</span><span class="p">.</span><span class="n">log</span>
</span><span class='line'><span class="n">imp</span> <span class="k">schema_name</span><span class="o">/</span><span class="n">password</span>  <span class="n">BUFFER</span><span class="o">=</span><span class="mi">1000000000</span> <span class="n">FILE</span><span class="o">=/</span><span class="k">data</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">dump</span><span class="o">/</span><span class="n">imp_file_name</span><span class="p">.</span><span class="n">dmp</span>  <span class="n">FROMUSER</span><span class="o">=</span><span class="n">from_schema</span> <span class="n">TOUSER</span><span class="o">=</span><span class="k">schema_name</span> <span class="n">log</span><span class="o">=</span><span class="n">logfile</span><span class="p">.</span><span class="n">log</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Test]]></title>
    <link href="http://RookieDBA.github.io/blog/2014/08/21/test/"/>
    <updated>2014-08-21T17:16:23+08:00</updated>
    <id>http://RookieDBA.github.io/blog/2014/08/21/test</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
</feed>
